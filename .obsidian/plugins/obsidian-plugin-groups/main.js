/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => PgMain
});
module.exports = __toCommonJS(main_exports);
var import_obsidian12 = require("obsidian");

// src/GroupSettingsTab.ts
var import_obsidian11 = require("obsidian");

// src/GroupEditModal.ts
var import_obsidian10 = require("obsidian");

// src/Utils/Constants.ts
var disableStartupTimeout = 25;
var pluginId = "obsidian-plugin-groups";
var deviceNameKey = "obsidian-plugin-groups-device-name";
var knownPluginIdsKey = "obsidian-plugin-groups-known-plugins";

// src/PluginGroup.ts
var import_obsidian = require("obsidian");

// src/PgPlugin.ts
var PgPlugin = class {
  constructor(id, name) {
    this.id = id;
    this.name = name;
  }
};

// src/Managers/PluginManager.ts
var _PluginManager = class {
  static async queuePluginForEnable(plugin) {
    if (this.checkPluginEnabled(plugin)) {
      return false;
    }
    if (this.enablePluginQueue.has(plugin.id)) {
      return false;
    }
    this.enablePluginQueue.add(plugin.id);
    const enabled = await this.enablePlugin(plugin);
    if (enabled) {
      this.pgEnabledPlugins.add(plugin.id);
    }
    this.enablePluginQueue.delete(plugin.id);
    return true;
  }
  static queueDisablePlugin(plugin) {
    if (!this.checkPluginEnabled(plugin)) {
      return false;
    }
    if (this.disablePluginQueue.has(plugin.id)) {
      return;
    }
    this.disablePluginQueue.add(plugin.id);
    this.disablePlugin(plugin);
    this.pgEnabledPlugins.delete(plugin.id);
    this.disablePluginQueue.delete(plugin.id);
  }
  static loadNewPlugins() {
    if (_PluginManager.getKnownPluginIds() === null) {
      _PluginManager.setKnownPluginIds(_PluginManager.getInstalledPluginIds());
    } else {
      const knownPlugins = _PluginManager.getKnownPluginIds();
      const installedPlugins = _PluginManager.getInstalledPluginIds();
      _PluginManager.setKnownPluginIds(installedPlugins);
      const newPlugins = new Set([...installedPlugins].filter((id) => !(knownPlugins == null ? void 0 : knownPlugins.has(id))));
      if (newPlugins.size <= 0) {
        return;
      }
      Manager.getInstance().groupsMap.forEach((g) => {
        if (g.autoAdd) {
          newPlugins.forEach((pluginId2) => {
            const plugin = _PluginManager.getInstalledPluginFromId(pluginId2);
            if (plugin) {
              g.addPlugin(plugin);
            }
          });
        }
      });
      Manager.getInstance().saveSettings();
    }
  }
  static getKnownPluginIds() {
    const ids = loadVaultLocalStorage(knownPluginIdsKey);
    if (!ids) {
      return null;
    }
    return new Set(JSON.parse(ids));
  }
  static setKnownPluginIds(ids) {
    if (!ids) {
      return;
    }
    const setAsString = JSON.stringify([...ids]);
    saveVaultLocalStorage(knownPluginIdsKey, setAsString);
  }
  static getInstalledPluginIds() {
    const manifests = app.plugins.manifests;
    const installedPlugins = /* @__PURE__ */ new Set();
    for (const key in manifests) {
      installedPlugins.add(key);
    }
    return installedPlugins;
  }
  static getInstalledPluginFromId(id) {
    if (!app.plugins.manifests[id]) {
      return null;
    }
    return new PgPlugin(this.app.plugins.manifests[id].id, this.app.plugins.manifests[id].name);
  }
  static getAllAvailablePlugins() {
    const manifests = app.plugins.manifests;
    const plugins = [];
    for (const key in manifests) {
      if (manifests[key].id === pluginId)
        continue;
      const info = new PgPlugin(manifests[key].id, manifests[key].name);
      plugins.push(info);
    }
    return plugins;
  }
  static checkPluginEnabled(plugin) {
    return app.plugins.enabledPlugins.has(plugin.id) || this.checkPluginEnabledFromPluginGroups(plugin);
  }
  static checkPluginEnabledFromPluginGroups(plugin) {
    return this.pgEnabledPlugins.has(plugin.id);
  }
  static enablePlugin(plugin) {
    return app.plugins.enablePlugin(plugin.id);
  }
  static disablePlugin(plugin) {
    return app.plugins.disablePlugin(plugin.id);
  }
};
var PluginManager = _PluginManager;
PluginManager.enablePluginQueue = /* @__PURE__ */ new Set();
PluginManager.disablePluginQueue = /* @__PURE__ */ new Set();
PluginManager.pgEnabledPlugins = /* @__PURE__ */ new Set();

// src/PluginGroup.ts
var PluginGroup = class {
  constructor(pgData) {
    this.loadAtStartup = false;
    this.disableOnStartup = false;
    this.delay = 0;
    var _a, _b, _c, _d, _e;
    this.id = pgData.id;
    this.name = pgData.name;
    this.assignAndLoadPlugins(pgData.plugins);
    this.groupIds = (_a = pgData.groupIds) != null ? _a : [];
    this.loadAtStartup = (_b = pgData.loadAtStartup) != null ? _b : false;
    this.disableOnStartup = (_c = pgData.disableOnStartup) != null ? _c : false;
    this.delay = (_d = pgData.delay) != null ? _d : 2;
    this.generateCommands = (_e = pgData.generateCommands) != null ? _e : false;
    this.assignedDevices = pgData.assignedDevices;
    this.autoAdd = pgData.autoAdd;
  }
  groupActive() {
    var _a;
    if (!this.assignedDevices || this.assignedDevices.length === 0) {
      return true;
    }
    const activeDevice = getCurrentlyActiveDevice();
    if (!activeDevice) {
      return true;
    }
    return !!((_a = this.assignedDevices) == null ? void 0 : _a.contains(activeDevice));
  }
  assignAndLoadPlugins(plugins) {
    this.plugins = plugins != null ? plugins : [];
  }
  startup() {
    if (!this.loadAtStartup) {
      return;
    }
    if (this.disableOnStartup) {
      setTimeout(async () => {
        await this.disable();
      }, this.delay * 1e3);
      return;
    }
    setTimeout(async () => {
      await this.enable();
    }, this.delay * 1e3);
    return;
  }
  async enable() {
    var _a;
    if (!this.groupActive()) {
      return;
    }
    const pluginPromises = [];
    for (const plugin of this.plugins) {
      pluginPromises.push(PluginManager.queuePluginForEnable(plugin));
    }
    await Promise.allSettled(pluginPromises);
    for (const groupId of this.groupIds) {
      await ((_a = groupFromId(groupId)) == null ? void 0 : _a.enable());
    }
    if (Manager.getInstance().showNoticeOnGroupLoad) {
      const messageString = "Loaded " + this.name;
      if (Manager.getInstance().showNoticeOnGroupLoad === "short") {
        new import_obsidian.Notice(messageString);
      } else if (Manager.getInstance().showNoticeOnGroupLoad === "normal") {
        new import_obsidian.Notice(messageString + "\n" + this.getGroupListString());
      }
    }
  }
  disable() {
    if (!this.groupActive()) {
      return;
    }
    this.plugins.forEach((plugin) => {
      PluginManager.queueDisablePlugin(plugin);
    });
    this.groupIds.forEach((groupId) => {
      var _a;
      (_a = groupFromId(groupId)) == null ? void 0 : _a.disable();
    });
    if (Manager.getInstance().showNoticeOnGroupLoad !== "none") {
      const messageString = "Disabled " + this.name;
      if (Manager.getInstance().showNoticeOnGroupLoad === "short") {
        new import_obsidian.Notice(messageString);
      } else if (Manager.getInstance().showNoticeOnGroupLoad === "normal") {
        new import_obsidian.Notice(messageString + "\n" + this.getGroupListString());
      }
    }
  }
  getGroupListString() {
    const existingPluginsInGroup = PluginManager.getAllAvailablePlugins().filter((p) => this.plugins.map((p2) => p2.id).contains(p.id));
    let messageString = "";
    this.plugins && this.plugins.length > 0 ? messageString += "- Plugins:\n" + existingPluginsInGroup.map((p) => " - " + p.name + "\n").join("") : messageString += "";
    this.groupIds && this.groupIds.length > 0 ? messageString += "- Groups:\n" + this.groupIds.map((g) => {
      const group = groupFromId(g);
      if (group && group.groupActive()) {
        return " - " + group.name + "\n";
      }
    }).join("") : messageString += "";
    return messageString;
  }
  addPlugin(plugin) {
    if (this.plugins.map((p) => p.id).contains(plugin.id))
      return false;
    this.plugins.push(plugin);
    return true;
  }
  addGroup(group) {
    if (!group.wouldHaveCyclicGroups(this.id)) {
      if (this.groupIds.contains(group.id))
        return false;
      this.groupIds.push(group.id);
      return true;
    } else {
      new import_obsidian.Notice("Couldn't add this group, it would create a loop of group activations:\n Group A \u2192 Group B \u2192 Group A", 4e3);
    }
    return false;
  }
  removePlugin(plugin) {
    const indexOfPlugin = this.plugins.map((p) => p.id).indexOf(plugin.id);
    if (indexOfPlugin === -1)
      return true;
    return this.plugins.splice(indexOfPlugin, 1).length > 0;
  }
  removeGroup(group) {
    const indexOfGroup = this.groupIds.indexOf(group.id);
    if (indexOfGroup === -1)
      return true;
    return this.groupIds.splice(indexOfGroup, 1).length > 0;
  }
  wouldHaveCyclicGroups(idToCheck) {
    var _a;
    if (this.id === idToCheck) {
      return true;
    }
    for (let i = 0; i < this.groupIds.length; i++) {
      const groupId = this.groupIds[i];
      if ((_a = groupFromId(groupId)) == null ? void 0 : _a.wouldHaveCyclicGroups(idToCheck)) {
        return true;
      }
    }
    return false;
  }
  getAllPluginIdsControlledByGroup() {
    let pluginsArr = this.plugins.map((plugin) => plugin.id);
    this.groupIds.forEach((gid) => {
      const group = groupFromId(gid);
      if (group) {
        pluginsArr = [...pluginsArr, ...group.getAllPluginIdsControlledByGroup()];
      }
    });
    return new Set(pluginsArr);
  }
};

// src/Managers/Manager.ts
var DEFAULT_SETTINGS = {
  groupsMap: /* @__PURE__ */ new Map(),
  generateCommands: true,
  showNoticeOnGroupLoad: "none",
  devices: []
};
var Manager = class {
  constructor() {
  }
  static getInstance() {
    if (!Manager.instance) {
      Manager.instance = new Manager();
    }
    return Manager.instance;
  }
  async init(main) {
    this.main = main;
    await this.loadSettings();
    return this;
  }
  async loadSettings() {
    const savedSettings = await this.main.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS);
    if (!savedSettings) {
      return;
    }
    Object.keys(this.settings).forEach(function(key) {
      if (key in savedSettings) {
        Manager.getInstance().settings[key] = savedSettings[key];
      }
    });
    if (savedSettings.groups && Array.isArray(savedSettings.groups)) {
      this.settings.groupsMap = /* @__PURE__ */ new Map();
      savedSettings.groups.forEach((g) => {
        this.groupsMap.set(g.id, new PluginGroup(g));
      });
    }
  }
  get mapOfPluginsConnectedGroupsIncludingParentGroups() {
    const pluginsMemMap = /* @__PURE__ */ new Map();
    this.groupsMap.forEach((group) => {
      group.getAllPluginIdsControlledByGroup().forEach((plugin) => {
        var _a;
        if (!pluginsMemMap.has(pluginId)) {
          pluginsMemMap.set(plugin, /* @__PURE__ */ new Set());
        }
        (_a = pluginsMemMap.get(plugin)) == null ? void 0 : _a.add(group.id);
      });
    });
    return pluginsMemMap;
  }
  get mapOfPluginsDirectlyConnectedGroups() {
    const pluginsMemMap = /* @__PURE__ */ new Map();
    this.groupsMap.forEach((group) => {
      group.plugins.forEach((plugin) => {
        var _a;
        if (!pluginsMemMap.has(pluginId)) {
          pluginsMemMap.set(plugin.id, /* @__PURE__ */ new Set());
        }
        (_a = pluginsMemMap.get(plugin.id)) == null ? void 0 : _a.add(group.id);
      });
    });
    return pluginsMemMap;
  }
  async saveSettings() {
    var _a, _b, _c, _d;
    const persistentSettings = {
      groups: Array.from((_a = this.groupsMap.values()) != null ? _a : []),
      generateCommands: (_b = this.settings.generateCommands) != null ? _b : DEFAULT_SETTINGS.generateCommands,
      showNoticeOnGroupLoad: (_c = this.settings.showNoticeOnGroupLoad) != null ? _c : DEFAULT_SETTINGS.showNoticeOnGroupLoad,
      devices: (_d = this.settings.devices) != null ? _d : DEFAULT_SETTINGS.devices
    };
    await this.main.saveData(persistentSettings);
  }
  get pluginInstance() {
    return this.main;
  }
  get groupsMap() {
    return this.settings.groupsMap;
  }
  get generateCommands() {
    return this.settings.generateCommands;
  }
  set shouldGenerateCommands(val) {
    this.settings.generateCommands = val;
  }
  get showNoticeOnGroupLoad() {
    return this.settings.showNoticeOnGroupLoad;
  }
  set showNoticeOnGroupLoad(val) {
    this.settings.showNoticeOnGroupLoad = val;
  }
  get devices() {
    return this.settings.devices;
  }
};

// src/Utils/Utilities.ts
function generateGroupID(name, delay) {
  let id = nameToId((delay ? "stg-" : "pg-") + name);
  const groupMap = Manager.getInstance().groupsMap;
  if (!groupMap) {
    return void 0;
  }
  if (!groupMap.has(id)) {
    return id;
  }
  for (let i = 0; i < 512; i++) {
    const nrdId = id + i.toString();
    id += i.toString();
    if (!groupMap.has(id)) {
      return delay ? nrdId + delay.toString() : nrdId;
    }
  }
  return void 0;
}
function nameToId(name) {
  return name.replace(/[\W_]/g, "").toLowerCase();
}
function saveVaultLocalStorage(key, object) {
  app.saveLocalStorage(key, object);
}
function loadVaultLocalStorage(key) {
  return app.loadLocalStorage(key);
}
function getCurrentlyActiveDevice() {
  const device = loadVaultLocalStorage(deviceNameKey);
  if (typeof device === "string") {
    return device;
  }
  return null;
}
function setCurrentlyActiveDevice(device) {
  saveVaultLocalStorage(deviceNameKey, device);
}
function groupFromId(id) {
  return Manager.getInstance().groupsMap.get(id);
}

// src/Components/ConfirmationPopupModal.ts
var import_obsidian2 = require("obsidian");
var ConfirmationPopupModal = class extends import_obsidian2.Modal {
  constructor(app2, headerText, cancelText, confirmText, onConfirmListener) {
    super(app2);
    this.onConfirm = new Event("onConfirm");
    this.headerText = headerText;
    this.eventTarget = new EventTarget();
    this.cancelText = cancelText != null ? cancelText : "Cancel";
    this.confirmText = confirmText != null ? confirmText : "Confirm";
    if (onConfirmListener) {
      this.eventTarget.addEventListener(this.onConfirm.type, onConfirmListener);
    }
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h2", { text: this.headerText });
    new import_obsidian2.Setting(contentEl).addButton((btn) => {
      btn.setButtonText(this.cancelText);
      btn.onClick(() => this.close());
    }).addButton((btn) => {
      btn.setButtonText(this.confirmText);
      btn.onClick(() => {
        this.eventTarget.dispatchEvent(this.onConfirm);
        this.close();
      });
    });
  }
};

// src/GroupEditModal/GroupEditPluginsTab.ts
var import_obsidian6 = require("obsidian");

// src/Components/DropdownActionButton.ts
var import_obsidian3 = require("obsidian");
var DropdownActionButton = class {
  constructor(parentEl, mainLabel, dropdownOptions, options) {
    this.mainLabel = mainLabel;
    this.dropdownOptions = dropdownOptions;
    this.parentEl = parentEl;
    this.minWidth = options == null ? void 0 : options.width;
    this.drpIcon = options == null ? void 0 : options.drpIcon;
    this.render();
  }
  rerender() {
    this.containerEL.remove();
    this.render();
  }
  render() {
    this.containerEL = this.parentEl.createEl("button", { cls: "pg-drp-btn" });
    if (this.minWidth) {
      this.containerEL.style.minWidth = this.minWidth;
    }
    this.containerEL.onClickEvent(() => this.toggleDropdown());
    const activeOptionBtn = this.containerEL.createSpan({ cls: "pg-drp-btn-main-label" });
    this.setElementTextOrIcon(activeOptionBtn, this.mainLabel.label, this.mainLabel.icon);
    if (this.drpIcon) {
      const iconSpan = this.containerEL.createSpan();
      (0, import_obsidian3.setIcon)(iconSpan, this.drpIcon);
      iconSpan.style.paddingTop = "12px";
    } else {
      this.containerEL.createSpan({ text: "\u25BC" });
    }
    this.drpList = this.containerEL.createEl("ul", { cls: "pg-drp-btn-list" });
    this.dropdownOptions.forEach((option) => {
      const item = this.drpList.createEl("li");
      this.setElementTextOrIcon(item, option.label, option.icon);
      item.onClickEvent((evt) => {
        evt.stopPropagation();
        option.func();
        this.closeDropdown();
      });
    });
  }
  setElementTextOrIcon(element, label, icon) {
    if (icon) {
      (0, import_obsidian3.setIcon)(element.createSpan(), icon);
    } else {
      element.setText(label);
    }
  }
  toggleDropdown() {
    this.drpList.hasClass("is-active") ? this.closeDropdown() : this.openDropdown();
  }
  closeDropdown() {
    this.drpList.removeClass("is-active");
  }
  openDropdown() {
    this.drpList.addClass("is-active");
    const outsideClickController = new AbortController();
    document.addEventListener("click", (event) => {
      if (!this.containerEL.contains(event.targetNode) && this.drpList.hasClass("is-active")) {
        this.closeDropdown();
        outsideClickController.abort();
      }
    }, outsideClickController);
  }
};

// src/Components/PluginList.ts
var import_obsidian4 = require("obsidian");
var PluginList = class {
  constructor(parentEL, pluginsToDisplay, actionOption) {
    this.pluginListTarget = new EventTarget();
    this.plugins = pluginsToDisplay;
    this.parentEL = parentEL;
    if (actionOption) {
      this.ownerGroup = actionOption == null ? void 0 : actionOption.group;
      this.pluginListTarget.addEventListener("listToggleClicked", (evt) => {
        actionOption.onClickAction(evt.detail);
      });
    }
    this.generateList();
  }
  updateList(pluginsToDisplay) {
    this.plugins = pluginsToDisplay;
    this.render();
  }
  render() {
    this.pluginListEl.remove();
    this.generateList();
  }
  generateList() {
    this.pluginListEl = this.parentEL.createEl("div");
    this.pluginListEl.addClass("group-edit-modal-plugin-list");
    this.plugins.forEach((plugin) => {
      const setting = new import_obsidian4.Setting(this.pluginListEl).setName(plugin.name);
      if (this.ownerGroup) {
        const btn = new import_obsidian4.ButtonComponent(setting.settingEl);
        this.setIconForPluginBtn(btn, plugin.id);
        btn.onClick(() => {
          this.pluginListTarget.dispatchEvent(new CustomEvent("listToggleClicked", { detail: plugin }));
          this.setIconForPluginBtn(btn, plugin.id);
        });
      }
    });
  }
  setIconForPluginBtn(btn, pluginId2) {
    if (!this.ownerGroup) {
      return;
    }
    btn.setIcon(this.ownerGroup.plugins.map((p) => p.id).contains(pluginId2) ? "check-circle" : "circle");
  }
};

// src/Components/RemovableChip.ts
var import_obsidian5 = require("obsidian");
var RemovableChip = class {
  constructor(parentEl, label, onClose) {
    this.parentEl = parentEl;
    this.label = label;
    this.onClose = onClose;
    this.render();
  }
  render() {
    this.chipEl = this.parentEl.createDiv({ cls: "pg-chip" });
    this.chipEl.createSpan({ text: this.label });
    const closeBtn = this.chipEl.createDiv({ cls: "pg-chip-close-btn" });
    (0, import_obsidian5.setIcon)(closeBtn, "x", 1);
    closeBtn.onClickEvent(() => {
      this.onClose();
      this.chipEl.remove();
    });
  }
};

// src/Components/FilteredGroupsList.ts
var FilteredGroupsList = class {
  constructor(parentEl, groups, onChipClosed) {
    this.groups = groups;
    this.parentEl = parentEl;
    this.onChipClosed = onChipClosed;
    this.render();
  }
  update(groups) {
    this.listEL.remove();
    this.groups = groups;
    this.render();
  }
  render() {
    this.listEL = this.parentEl.createDiv({ cls: "pg-group-filter-list" });
    this.listEL.createSpan({ text: "Filters:" });
    this.groups.forEach((group) => {
      new RemovableChip(this.listEL, group.name, () => {
        this.groups.delete(group.id);
        this.onChipClosed();
      });
    });
  }
};

// src/GroupEditModal/GroupEditPluginsTab.ts
var GroupEditPluginsTab = class {
  constructor(group, parentEl) {
    this.availablePlugins = PluginManager.getAllAvailablePlugins();
    this.sortModes = {
      byName: "By Name",
      byNameAndSelected: "By Name & Selected"
    };
    this.selectedSortMode = this.sortModes.byNameAndSelected;
    this.filteredGroups = /* @__PURE__ */ new Map();
    this.groupToEdit = group;
    this.filteredPlugins = this.availablePlugins;
    this.containerEl = this.generatePluginSection(parentEl);
  }
  generatePluginSection(parentElement) {
    const pluginSection = parentElement.createDiv({ cls: "pg-tabbed-content" });
    pluginSection.createEl("h5", { text: "Plugins" });
    const searchAndList = pluginSection.createEl("div");
    new import_obsidian6.Setting(searchAndList).setName("Search").addText((txt) => {
      txt.setPlaceholder("Search for Plugin...");
      txt.onChange((search) => {
        this.searchPlugins(search);
      });
    });
    const filtersAndSelectionContainer = searchAndList.createDiv({ cls: "pg-plugin-filter-container" });
    const filtersAndSelection = filtersAndSelectionContainer.createDiv({ cls: "pg-plugin-filter-section" });
    const filters = filtersAndSelection.createDiv();
    const filteredGroupsList = new FilteredGroupsList(filtersAndSelectionContainer, this.filteredGroups, () => this.filterAndSortPlugins());
    const toggleGroupFilter = (group) => {
      this.filteredGroups.has(group.id) ? this.filteredGroups.delete(group.id) : this.filteredGroups.set(group.id, group);
      filteredGroupsList.update(this.filteredGroups);
    };
    const groupOptionsForButton = [{
      label: "All groups",
      func: () => {
        if (this.filteredGroups.size === Manager.getInstance().groupsMap.size) {
          Manager.getInstance().groupsMap.forEach((group) => {
            this.filteredGroups.delete(group.id);
          });
        } else {
          Manager.getInstance().groupsMap.forEach((group) => {
            this.filteredGroups.set(group.id, group);
          });
        }
        filteredGroupsList.update(this.filteredGroups);
        this.filterAndSortPlugins();
      }
    }];
    Manager.getInstance().groupsMap.forEach((group) => {
      groupOptionsForButton.push({
        label: group.name,
        func: () => {
          toggleGroupFilter(group);
          this.filterAndSortPlugins();
        }
      });
    });
    new DropdownActionButton(filters, { label: "Filter Groups" }, groupOptionsForButton, { drpIcon: "filter" });
    const sortButton = new DropdownActionButton(filters, { label: "Sort" }, [
      {
        label: this.sortModes.byName,
        func: () => {
          this.selectedSortMode = this.sortModes.byName;
          sortButton.mainLabel.label = this.sortModes.byName;
          sortButton.rerender();
          this.filterAndSortPlugins();
        }
      },
      {
        label: this.sortModes.byNameAndSelected,
        func: () => {
          this.selectedSortMode = this.sortModes.byNameAndSelected;
          sortButton.mainLabel.label = this.sortModes.byNameAndSelected;
          sortButton.rerender();
          this.filterAndSortPlugins();
        }
      }
    ], { width: "80px", drpIcon: "sort-desc" });
    new DropdownActionButton(filtersAndSelection, { label: "Bulk Select" }, [
      { label: "Select all", func: () => this.selectAllFilteredPlugins() },
      { label: "Deselect all", func: () => this.deselectAllFilteredPlugins() }
    ]);
    this.pluginsList = new PluginList(searchAndList, this.sortPlugins(this.filteredPlugins, this.selectedSortMode), { group: this.groupToEdit, onClickAction: (plugin) => this.togglePluginForGroup(plugin) });
    return pluginSection;
  }
  filterAndSortPlugins() {
    this.filteredPlugins = this.availablePlugins;
    if (this.searchTerm && this.searchTerm !== "") {
      this.filteredPlugins = this.filteredPlugins.filter((p) => p.name.toLowerCase().contains(this.searchTerm.toLowerCase()));
    }
    if (this.filteredGroups.size > 0) {
      this.filteredPlugins = this.filterPluginsByGroups(this.filteredPlugins, this.filteredGroups);
    }
    this.filteredPlugins = this.sortPlugins(this.filteredPlugins, this.selectedSortMode);
    this.showFilteredPlugins();
  }
  filterPluginsByGroups(pluginsToFilter, groupsToExclude) {
    const pluginMembershipMap = Manager.getInstance().mapOfPluginsDirectlyConnectedGroups;
    return pluginsToFilter.filter((plugin) => {
      var _a;
      if (!pluginMembershipMap.has(plugin.id)) {
        return true;
      }
      for (const groupId of (_a = pluginMembershipMap.get(plugin.id)) != null ? _a : []) {
        if (groupsToExclude.has(groupId)) {
          return false;
        }
      }
      return true;
    });
  }
  searchPlugins(search) {
    this.searchTerm = search;
    this.filterAndSortPlugins();
    this.showFilteredPlugins();
  }
  showFilteredPlugins() {
    this.pluginsList.updateList(this.filteredPlugins);
  }
  deselectAllFilteredPlugins() {
    this.filteredPlugins.forEach((plugin) => this.groupToEdit.removePlugin(plugin));
    this.showFilteredPlugins();
  }
  selectAllFilteredPlugins() {
    this.filteredPlugins.forEach((plugin) => this.groupToEdit.addPlugin(plugin));
    this.showFilteredPlugins();
  }
  sortPlugins(plugins, sortMode) {
    const sortedArray = [...plugins];
    if (sortMode === this.sortModes.byName) {
      return sortedArray.sort((a, b) => a.name.localeCompare(b.name));
    }
    if (sortMode === this.sortModes.byNameAndSelected) {
      sortedArray.sort((a, b) => a.name.localeCompare(b.name));
      sortedArray.sort((a, b) => {
        const aInGroup = this.isPluginInGroup(a);
        const bInGroup = this.isPluginInGroup(b);
        if (aInGroup && !bInGroup)
          return -1;
        else if (!aInGroup && bInGroup)
          return 1;
        else
          return 0;
      });
    }
    return sortedArray;
  }
  isPluginInGroup(plugin) {
    return this.groupToEdit.plugins.map((p) => p.id).contains(plugin.id);
  }
  togglePluginForGroup(plugin) {
    if (this.groupToEdit.plugins.map((p) => p.id).contains(plugin.id)) {
      this.groupToEdit.removePlugin(plugin);
    } else {
      this.groupToEdit.addPlugin(plugin);
    }
  }
};

// src/GroupEditModal/GroupEditGroupsTab.ts
var import_obsidian7 = require("obsidian");
var GroupEditGroupsTab = class {
  constructor(group, parentEl) {
    this.groupListElements = /* @__PURE__ */ new Map();
    this.groupToEdit = group;
    this.availableGroups = Array.from(Manager.getInstance().groupsMap.values()).filter((g) => g.id !== group.id);
    this.containerEl = this.generateGroupsSection(parentEl);
  }
  generateGroupsSection(parentElement) {
    const groupSection = parentElement.createDiv({ cls: "pg-tabbed-content" });
    groupSection.createEl("h5", { text: "Groups" });
    const searchAndList = groupSection.createEl("div");
    new import_obsidian7.Setting(searchAndList).setName("Search").addText((txt) => {
      txt.setPlaceholder("Search for Groups...");
      txt.onChange((search) => {
        this.searchGroups(search);
      });
    });
    const groupList = searchAndList.createEl("div");
    groupList.addClass("group-edit-modal-plugin-list");
    this.groupListElements = /* @__PURE__ */ new Map();
    this.sortGroups(this.availableGroups).forEach((pluginGroup) => {
      const setting = new import_obsidian7.Setting(groupList).setName(pluginGroup.name).addButton((btn) => {
        btn.setIcon(this.groupToEdit.groupIds.contains(pluginGroup.id) ? "check-circle" : "circle").onClick(() => {
          this.toggleGroupForGroup(pluginGroup);
          btn.setIcon(this.groupToEdit.groupIds.contains(pluginGroup.id) ? "check-circle" : "circle");
        });
      });
      this.groupListElements.set(pluginGroup.id, setting);
    });
    return groupSection;
  }
  searchGroups(search) {
    const hits = this.availableGroups.filter((p) => p.name.toLowerCase().contains(search.toLowerCase())).map((p) => p.id);
    this.groupListElements.forEach((group) => group.settingEl.hide());
    hits.forEach((id) => {
      var _a;
      return (_a = this.groupListElements.get(id)) == null ? void 0 : _a.settingEl.show();
    });
  }
  sortGroups(groups) {
    return groups.sort((a, b) => {
      const aInGroup = this.isGroupInGroup(a);
      const bInGroup = this.isGroupInGroup(b);
      if (aInGroup && !bInGroup)
        return -1;
      else if (!aInGroup && bInGroup)
        return 1;
      else {
        return a.name.localeCompare(b.name);
      }
    });
  }
  isGroupInGroup(plugin) {
    return this.groupToEdit.plugins.map((p) => p.id).contains(plugin.id);
  }
  toggleGroupForGroup(group) {
    if (this.groupToEdit.groupIds.contains(group.id)) {
      return this.groupToEdit.removeGroup(group);
    } else {
      return this.groupToEdit.addGroup(group);
    }
  }
};

// src/GroupEditModal/GroupEditGeneralTab.ts
var import_obsidian9 = require("obsidian");

// src/DeviceSelectionModal.ts
var import_obsidian8 = require("obsidian");
var DeviceSelectionModal = class extends import_obsidian8.Modal {
  constructor(app2, onConfirmSelectionListener, selectedDevices) {
    var _a;
    super(app2);
    this.eventTarget = new EventTarget();
    this.onConfirm = new CustomEvent("onConfirm", {
      detail: {
        devices: []
      }
    });
    this.selectedDevices = /* @__PURE__ */ new Set();
    this.headerText = "New device detected please enter a unique name.";
    this.cancelText = "Cancel";
    this.confirmText = "Confirm";
    this.selectedDevices = new Set(selectedDevices);
    if (((_a = this.selectedDevices) == null ? void 0 : _a.size) > 0) {
      this.onConfirm.detail.devices = Array.from(this.selectedDevices.values());
    }
    this.eventTarget.addEventListener(this.onConfirm.type, onConfirmSelectionListener);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h2", { text: this.headerText });
    contentEl.createEl("h6", { text: "Existing Devices" });
    Manager.getInstance().devices.forEach((device) => {
      new import_obsidian8.Setting(contentEl).setName(device).addButton((tgl) => {
        tgl.setIcon(this.selectedDevices.has(device) ? "check-circle" : "circle").onClick(() => {
          if (this.selectedDevices.has(device)) {
            this.selectedDevices.delete(device);
            tgl.setIcon("circle");
          } else {
            this.selectedDevices.add(device);
            tgl.setIcon("check-circle");
          }
        });
      });
    });
    new import_obsidian8.Setting(contentEl).addButton((btn) => {
      btn.setButtonText(this.cancelText);
      btn.onClick(() => this.close());
    }).addButton((btn) => {
      btn.setButtonText(this.confirmText);
      btn.onClick(() => {
        this.onConfirm.detail.devices = Array.from(this.selectedDevices.values());
        this.eventTarget.dispatchEvent(this.onConfirm);
        this.close();
      });
    });
  }
};

// src/GroupEditModal/GroupEditGeneralTab.ts
var GroupEditGeneralTab = class {
  constructor(group, parentEl) {
    this.groupToEdit = group;
    this.containerEl = this.generateGeneralSettingsSection(parentEl);
  }
  generateGeneralSettingsSection(contentEl) {
    const generalSettingsSection = contentEl.createDiv({ cls: "pg-tabbed-content is-active" });
    generalSettingsSection.createEl("h5", { text: "General" });
    new import_obsidian9.Setting(generalSettingsSection).setName("Commands").setDesc("Add Commands to enable/disable this group").addToggle((tgl) => {
      tgl.setValue(this.groupToEdit.generateCommands);
      tgl.onChange((value) => this.groupToEdit.generateCommands = value);
    });
    new import_obsidian9.Setting(generalSettingsSection).setName("Auto Add").setDesc("Automatically add new Plugins to this group").addToggle((tgl) => {
      var _a;
      tgl.setValue((_a = this.groupToEdit.autoAdd) != null ? _a : false);
      tgl.onChange((value) => this.groupToEdit.autoAdd = value);
    });
    const devicesSetting = new import_obsidian9.Setting(generalSettingsSection).setName("Devices").setDesc(this.getDevicesDescription()).addButton((btn) => {
      btn.setIcon("pencil").onClick(() => {
        new DeviceSelectionModal(app, (evt) => {
          this.groupToEdit.assignedDevices = evt.detail.devices;
          devicesSetting.setDesc(this.getDevicesDescription());
        }, this.groupToEdit.assignedDevices).open();
      });
    });
    this.GenerateStartupSettings(generalSettingsSection);
    return generalSettingsSection;
  }
  getDevicesDescription() {
    let description = "Active on All devices";
    if (!this.groupToEdit.assignedDevices) {
      return description;
    }
    const arr = this.groupToEdit.assignedDevices.filter((device) => Manager.getInstance().devices.contains(device));
    if ((arr == null ? void 0 : arr.length) > 0) {
      description = "Active on: " + arr.reduce((acc, curr, i, arr2) => {
        if (i < 3) {
          return acc + ", " + curr;
        } else if (i === arr2.length - 1) {
          return acc + ", ... and " + (i - 2) + " other" + (i - 2 > 1 ? "s" : "");
        }
        return acc;
      });
    }
    return description;
  }
  GenerateStartupSettings(contentEl) {
    const startupParent = contentEl.createEl("div");
    startupParent.createEl("h6", { text: "Startup" });
    let delaySetting;
    let behaviourElement;
    const ChangeOptionVisibility = () => {
      if (delaySetting) {
        this.groupToEdit.loadAtStartup ? delaySetting.settingEl.show() : delaySetting.settingEl.hide();
      }
      if (behaviourElement) {
        this.groupToEdit.loadAtStartup ? behaviourElement.show() : behaviourElement.hide();
      }
    };
    new import_obsidian9.Setting(startupParent).setName("Load on Startup").addDropdown((drp) => {
      behaviourElement = drp.selectEl;
      drp.addOption("enable", "Enable");
      drp.addOption("disable", "Disable");
      drp.setValue(this.groupToEdit.disableOnStartup ? "disable" : "enable");
      drp.onChange((value) => {
        value === "disable" ? this.groupToEdit.disableOnStartup = true : this.groupToEdit.disableOnStartup = false;
      });
    }).addToggle((tgl) => {
      tgl.onChange((value) => {
        this.groupToEdit.loadAtStartup = value;
        ChangeOptionVisibility();
      });
      tgl.setValue(this.groupToEdit.loadAtStartup);
    });
    delaySetting = new import_obsidian9.Setting(startupParent).setName("Delay").addSlider((slider) => {
      slider.setValue(this.groupToEdit.delay);
      slider.setLimits(0, disableStartupTimeout, 1);
      slider.onChange((value) => {
        this.groupToEdit.delay = value;
        delaySetting.setDesc(value.toString());
      });
    }).setDesc(this.groupToEdit.delay.toString());
    ChangeOptionVisibility();
  }
};

// src/Managers/CommandManager.ts
var CommandManager = class {
  constructor() {
    this.enableGroupCommandPrefix = "plugin-groups-enable-";
    this.disableGroupCommandPrefix = "plugin-groups-disable-";
    this.cnEnablePrefix = "Plugin Groups: Enable ";
    this.cnDisablePrefix = "Plugin Groups: Disable ";
    this.commandMap = /* @__PURE__ */ new Map();
  }
  static getInstance() {
    if (!CommandManager.instance) {
      CommandManager.instance = new CommandManager();
    }
    return CommandManager.instance;
  }
  AddGroupCommands(groupID) {
    const group = groupFromId(groupID);
    if (!group)
      return;
    const enableId = this.enableGroupCommandPrefix + group.id;
    this.commandMap.set(enableId, Manager.getInstance().pluginInstance.addCommand({
      id: enableId,
      name: this.cnEnablePrefix + group.name,
      icon: "power",
      checkCallback: (checking) => {
        if (!this.shouldShowCommand(group))
          return false;
        if (checking)
          return true;
        group.enable();
      }
    }));
    const disableId = this.disableGroupCommandPrefix + group.id;
    this.commandMap.set(disableId, Manager.getInstance().pluginInstance.addCommand({
      id: disableId,
      name: this.cnDisablePrefix + group.name,
      icon: "power-off",
      checkCallback: (checking) => {
        if (!this.shouldShowCommand(group))
          return false;
        if (checking)
          return true;
        group.disable();
      }
    }));
  }
  shouldShowCommand(group) {
    if (!Manager.getInstance().groupsMap.has(group.id))
      return false;
    if (!Manager.getInstance().generateCommands)
      return false;
    if (!group.groupActive()) {
      return false;
    }
    return group.generateCommands;
  }
  updateCommand(groupId) {
    const group = groupFromId(groupId);
    if (!group) {
      return;
    }
    let command = this.commandMap.get(this.enableGroupCommandPrefix + group.id);
    if (command) {
      command.name = this.cnEnablePrefix + group.name;
    }
    command = this.commandMap.get(this.disableGroupCommandPrefix + group.id);
    if (command) {
      command.name = this.cnDisablePrefix + group.name;
    }
  }
};

// src/GroupEditModal.ts
var GroupEditModal = class extends import_obsidian10.Modal {
  constructor(app2, settingsTab, group) {
    super(app2);
    this.discardChanges = true;
    this.settingsTab = settingsTab;
    this.groupToEdit = group;
    this.groupToEditCache = JSON.stringify(group);
  }
  onOpen() {
    const { modalEl } = this;
    modalEl.empty();
    const contentEl = modalEl.createEl("div", { cls: "group-edit-modal-content " });
    let generalSettings;
    let pluginsSection;
    let groupsSection;
    const nameSettingNameEl = new import_obsidian10.Setting(contentEl).addText((txt) => {
      txt.setValue(this.groupToEdit.name);
      txt.onChange((val) => {
        this.groupToEdit.name = val;
        nameSettingNameEl.setText('Editing "' + this.groupToEdit.name + '"');
      });
    }).nameEl.createEl("h2", { text: 'Editing "' + this.groupToEdit.name + '"' });
    const tabContainer = contentEl.createDiv({ cls: "pg-tabs" });
    const generalTab = tabContainer.createDiv({ cls: "pg-tab is-active" });
    generalTab.createSpan({ text: "General" });
    const pluginsTab = tabContainer.createDiv({ cls: "pg-tab" });
    pluginsTab.createSpan({ text: "Plugins" });
    const groupsTab = tabContainer.createDiv({ cls: "pg-tab" });
    groupsTab.createSpan({ text: "Groups" });
    const switchActive = (clicked) => {
      generalTab.removeClass("is-active");
      pluginsTab.removeClass("is-active");
      groupsTab.removeClass("is-active");
      generalSettings == null ? void 0 : generalSettings.removeClass("is-active");
      pluginsSection == null ? void 0 : pluginsSection.removeClass("is-active");
      groupsSection == null ? void 0 : groupsSection.removeClass("is-active");
      switch (clicked) {
        case "Plugins":
          pluginsSection == null ? void 0 : pluginsSection.addClass("is-active");
          pluginsTab == null ? void 0 : pluginsTab.addClass("is-active");
          break;
        case "Groups":
          groupsSection == null ? void 0 : groupsSection.addClass("is-active");
          groupsTab.addClass("is-active");
          break;
        default:
          generalSettings == null ? void 0 : generalSettings.addClass("is-active");
          generalTab.addClass("is-active");
          break;
      }
    };
    generalTab.onClickEvent(() => switchActive("General"));
    pluginsTab.onClickEvent(() => switchActive("Plugins"));
    groupsTab.onClickEvent(() => switchActive("Groups"));
    generalSettings = new GroupEditGeneralTab(this.groupToEdit, contentEl).containerEl;
    pluginsSection = new GroupEditPluginsTab(this.groupToEdit, contentEl).containerEl;
    groupsSection = new GroupEditGroupsTab(this.groupToEdit, contentEl).containerEl;
    this.generateFooter(modalEl);
  }
  generateFooter(parentElement) {
    const footer = parentElement.createEl("div");
    footer.addClass("group-edit-modal-footer");
    new import_obsidian10.Setting(footer).addButton((btn) => {
      btn.setButtonText("Delete");
      btn.onClick(() => new ConfirmationPopupModal(this.app, "You are about to delete: " + this.groupToEdit.name, void 0, "Delete", () => this.deleteGroup()).open());
    }).addButton((btn) => {
      btn.setButtonText("Cancel");
      btn.onClick(() => this.close());
    }).addButton((btn) => {
      btn.setButtonText("Save");
      btn.onClick(() => this.saveChanges());
    }).addExtraButton((btn) => {
      btn.setIcon("copy").setTooltip("Duplicate this group").onClick(() => this.duplicate());
    }).settingEl.addClass("modal-footer");
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    if (Manager.getInstance().groupsMap.has(this.groupToEdit.id) && this.discardChanges) {
      Object.assign(this.groupToEdit, JSON.parse(this.groupToEditCache));
    }
  }
  async saveChanges() {
    this.discardChanges = false;
    if (Manager.getInstance().groupsMap.has(this.groupToEdit.id)) {
      await this.editGroup(this.groupToEdit);
    } else {
      await this.addGroup(this.groupToEdit);
    }
  }
  async duplicate() {
    const duplicateGroup = new PluginGroup(this.groupToEdit);
    const groupMap = Manager.getInstance().groupsMap;
    if (!groupMap) {
      return;
    }
    duplicateGroup.name += "-Duplicate";
    const genId = generateGroupID(duplicateGroup.name);
    if (!genId) {
      return;
    }
    duplicateGroup.id = genId;
    await this.addGroup(duplicateGroup);
  }
  async addGroup(group) {
    Manager.getInstance().groupsMap.set(group.id, group);
    CommandManager.getInstance().AddGroupCommands(group.id);
    await this.persistChangesAndClose();
  }
  async editGroup(group) {
    Manager.getInstance().groupsMap.set(group.id, group);
    CommandManager.getInstance().updateCommand(group.id);
    await this.persistChangesAndClose();
  }
  async persistChangesAndClose() {
    await Manager.getInstance().saveSettings();
    this.settingsTab.display();
    this.close();
  }
  async deleteGroup() {
    Manager.getInstance().groupsMap.delete(this.groupToEdit.id);
    await Manager.getInstance().saveSettings();
    this.settingsTab.display();
    this.close();
  }
};

// src/GroupSettingsTab.ts
var GroupSettingsTab = class extends import_obsidian11.PluginSettingTab {
  constructor(app2, plugin) {
    super(app2, plugin);
  }
  display() {
    PluginManager.loadNewPlugins();
    const { containerEl } = this;
    containerEl.empty();
    const generalParent = containerEl.createEl("h4", { text: "General" });
    new import_obsidian11.Setting(generalParent).setName("Generate Commands for Groups").addToggle((tgl) => {
      var _a;
      tgl.setValue((_a = Manager.getInstance().generateCommands) != null ? _a : false);
      tgl.onChange(async (value) => {
        Manager.getInstance().shouldGenerateCommands = value;
        await Manager.getInstance().saveSettings();
      });
    });
    new import_obsidian11.Setting(generalParent).setName("Notice upon un-/loading groups").addDropdown((drp) => {
      var _a;
      drp.addOption("none", "None").addOption("short", "Short").addOption("normal", "Normal");
      drp.setValue((_a = Manager.getInstance().showNoticeOnGroupLoad) != null ? _a : "none");
      drp.onChange(async (value) => {
        Manager.getInstance().showNoticeOnGroupLoad = value;
        await Manager.getInstance().saveSettings();
      });
    });
    const groupParent = containerEl.createEl("div");
    groupParent.createEl("h5", { text: "Groups" });
    let addBtnEl;
    new import_obsidian11.Setting(groupParent).setName("Add Group").addText((text) => {
      this.groupNameField = text;
      this.groupNameField.setPlaceholder("Enter group name...").setValue(this.newGroupName).onChange((val) => {
        this.newGroupName = val;
        if (addBtnEl) {
          val.replace(" ", "").length > 0 ? addBtnEl.removeClass("btn-disabled") : addBtnEl.addClass("btn-disabled");
        }
      }).inputEl.onkeydown = async (e) => {
        if (e.key === "Enter") {
          await this.addNewGroup();
        }
      };
    }).addButton((btn) => {
      btn.setIcon("plus").onClick(() => this.addNewGroup());
      addBtnEl = btn.buttonEl;
      addBtnEl.addClass("btn-disabled");
    });
    this.GenerateGroupList(groupParent);
    this.GenerateDeviceList(containerEl);
  }
  GenerateGroupList(groupParent) {
    Manager.getInstance().groupsMap.forEach((group) => {
      const groupSetting = new import_obsidian11.Setting(groupParent).setName(group.name).addButton((btn) => {
        btn.setButtonText("Enable");
        btn.setIcon("power");
        btn.onClick(async () => {
          await group.enable();
        });
        group.groupActive() ? btn.buttonEl.removeClass("btn-disabled") : btn.buttonEl.addClass("btn-disabled");
      }).addButton((btn) => {
        btn.setButtonText("Disable");
        btn.setIcon("power-off");
        btn.onClick(() => group.disable());
        group.groupActive() ? btn.buttonEl.removeClass("btn-disabled") : btn.buttonEl.addClass("btn-disabled");
      }).addButton((btn) => {
        btn.setIcon("pencil");
        btn.onClick(() => this.editGroup(group));
      });
      if (group.loadAtStartup) {
        const descFrag = new DocumentFragment();
        const startupEl = descFrag.createEl("span");
        startupEl.createEl("b", {
          text: "Startup: "
        });
        startupEl.createEl("span", { text: "Delayed by " + group.delay + " seconds" });
        if (!group.groupActive()) {
          const activeEl = descFrag.createEl("span");
          activeEl.createEl("br");
          activeEl.createEl("b", { text: "Inactive: " });
          activeEl.createEl("span", { text: "Not enabled for current Device" });
        }
        groupSetting.setDesc(descFrag);
      }
    });
  }
  async addNewGroup() {
    const id = generateGroupID(this.newGroupName);
    if (!id) {
      console.error("Failed to create Group, please choose a different Name as there have been to many groups with the same name");
      return;
    }
    const newGroup = new PluginGroup({
      id,
      name: this.newGroupName
    });
    new GroupEditModal(this.app, this, newGroup).open();
    this.newGroupName = "";
    if (this.groupNameField) {
      this.groupNameField.setValue("");
    }
  }
  editGroup(group) {
    new GroupEditModal(this.app, this, group).open();
  }
  GenerateDeviceList(contentEl) {
    let newDeviceName = "";
    const CreateNewDevice = async () => {
      if (!newDeviceName || newDeviceName.replace(" ", "") === "") {
        return;
      }
      if (Manager.getInstance().devices.contains(newDeviceName)) {
        new import_obsidian11.Notice("Name already in use for other device");
        return;
      }
      Manager.getInstance().devices.push(newDeviceName);
      await Manager.getInstance().saveSettings();
      if (!getCurrentlyActiveDevice()) {
        setCurrentlyActiveDevice(newDeviceName);
      }
      this.display();
      newDeviceName = "";
      newDevNameText.setValue(newDeviceName);
    };
    contentEl.createEl("h4", { text: "Devices" });
    let deviceAddBtn;
    const deviceNameSetting = new import_obsidian11.Setting(contentEl).setName("New Device");
    const newDevNameText = new import_obsidian11.TextComponent(deviceNameSetting.controlEl);
    newDevNameText.setValue(newDeviceName).onChange((value) => {
      newDeviceName = value;
      if (deviceAddBtn) {
        value.replace(" ", "").length > 0 ? deviceAddBtn.buttonEl.removeClass("btn-disabled") : deviceAddBtn.buttonEl.addClass("btn-disabled");
      }
    }).setPlaceholder("Device Name").inputEl.onkeydown = async (e) => {
      if (e.key === "Enter") {
        await CreateNewDevice();
      }
    };
    deviceNameSetting.addButton((btn) => {
      deviceAddBtn = btn;
      deviceAddBtn.setIcon("plus").onClick(async () => {
        await CreateNewDevice();
      }).buttonEl.addClass("btn-disabled");
    });
    Manager.getInstance().devices.forEach((device) => {
      const deviceSetting = new import_obsidian11.Setting(contentEl).setName(device);
      if (getCurrentlyActiveDevice() === device) {
        deviceSetting.setDesc("Current Device").addButton((btn) => {
          btn.setIcon("trash");
          btn.onClick(() => new ConfirmationPopupModal(this.app, "This is the currently active device, are you sure?", void 0, "Delete", () => {
            this.ResetCurrentDevice();
          }).open());
        });
      } else {
        deviceSetting.addButton((btn) => {
          btn.setButtonText("Set as Current");
          btn.onClick(() => {
            setCurrentlyActiveDevice(device);
            this.display();
          });
        }).addButton((btn) => {
          btn.setIcon("trash");
          btn.onClick(() => new ConfirmationPopupModal(this.app, "You are about to delete: " + device, void 0, "Delete", async () => {
            Manager.getInstance().devices.remove(device);
            await Manager.getInstance().saveSettings();
            this.display();
          }).open());
        });
      }
    });
  }
  ResetCurrentDevice() {
    const device = getCurrentlyActiveDevice();
    if (!device) {
      return;
    }
    Manager.getInstance().devices.remove(device);
    setCurrentlyActiveDevice(null);
    this.display();
  }
};

// main.ts
var PgMain = class extends import_obsidian12.Plugin {
  constructor() {
    super(...arguments);
    this.doLogTime = false;
  }
  async onload() {
    await Manager.getInstance().init(this);
    if (this.doLogTime) {
      console.log("pg-afterManagerInit", window.performance.now() / 1e3);
    }
    PluginManager.loadNewPlugins();
    if (this.doLogTime) {
      console.log("pg-afterNewPluginLoad", window.performance.now() / 1e3);
    }
    this.addSettingTab(new GroupSettingsTab(this.app, this));
    if (this.doLogTime) {
      console.log("pg-afterAddSettings", window.performance.now() / 1e3);
    }
    if (!Manager.getInstance().groupsMap) {
      return;
    }
    if (Manager.getInstance().generateCommands) {
      Manager.getInstance().groupsMap.forEach((group) => CommandManager.getInstance().AddGroupCommands(group.id));
      if (this.doLogTime) {
        console.log("pg-afterGenerateCommand", window.performance.now() / 1e3);
      }
    }
    if (window.performance.now() / 1e3 < disableStartupTimeout) {
      Manager.getInstance().groupsMap.forEach((group) => {
        if (group.loadAtStartup)
          group.startup();
      });
    }
    if (this.doLogTime) {
      console.log("pg-afterInitStartups", window.performance.now() / 1e3);
    }
  }
  onunload() {
  }
};
